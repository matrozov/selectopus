!function(a){function b(b,c){var d={_items:{},_value:{},_languages:{},_options:{},$element:!1,$root:!1,$items:!1,$input:!1,$popup:!1,init:function(b,c){d.$element=b,d.$element.hide(),d._languages=a.fn.selectopus.languages,d._options=a.extend({},a.fn.selectopus.default,d.optionsPredefined(),c),d.create(),d.public.language=d._options.language,d.public.items=d._options.items,d.public.value=d._options.value,d.view.items.createList()},create:function(){d.$root=a("<div>").addClass("selectopus-root").insertAfter(d.$element),d._options.multiple&&d.$root.addClass("selectopus-multiple"),d.$items=a("<div>").addClass("selectopus-items form-control").click(d.view.popup.onToggle).appendTo(d.$root),d.$popup=a("<div>").addClass("selectopus-popup").appendTo("body"),d.$input=a("<input>").attr("type","text").addClass("selectopus-popup-input form-control input-sm").keyup(d.view.popup.onSearch).appendTo(d.$popup),d.$popupItems=a("<ul>").addClass("selectopus-popup-items").appendTo(d.$popup),a(document).click(d.view.popup.onClose)},optionsPredefined:function(){var b={multiple:d.$element.is("[multiple]"),items:{},value:[]};d.$element.find("option").each(function(){var c=a(this),d=c.prop("value");b.items[d]=c.text(),c.prop("selected")&&(b.multiple?b.value.push(d):b.value=d)});var c=a("html").attr("lang");return d.language.exists(c)&&(b.language=c),b},language:{exists:function(a){return void 0!==d._languages[a]},translate:function(a){return d._languages[d._options.language][a]},set:function(a){d.language.exists(a)&&(d._options.language=a,d.language.reload())},reload:function(){d.$input.attr("placeholder",d.language.translate("popupSearchPlaceholder"))}},items:{exists:function(a){return void 0!==d._items[a]},get:function(a){if(d.items.exists(a))return d._items[a]}},value:{keys:function(){var b=[];return a.each(d._value,function(a,c){b.push(a)}),b},exists:function(a){return void 0!==d._value[a]},save:function(){d.$element.empty(),a.each(d._value,function(b,c){a("<option>").attr("selected",!0).text(c).appendTo(d.$element)})},addList:function(b){a.each(b,function(a,b){d.value.add(b)})},add:function(a){d._value[a]=d.items.exists(a)?d.items.get(a):d.value.get(a)},remove:function(a){delete d._value[a]},get:function(a){if(d.value.exists(a))return d._value[a]},clear:function(){d._value={}}},view:{items:{createList:function(){d.view.items.clear(),a.each(d._value,function(a){d.view.items.create(a)})},create:function(b){a("<span>").addClass("selectopus-item").html(d._options.onRenderItem(d.public,b,d.value.get(b))).data("value",b).click(d.view.items.onClick).appendTo(d.$items)},clear:function(){d.$items.empty()},onClick:function(){var b=a(this).data("value");return d._options.onUnselect(d.public,b)&&(d.value.remove(b),d.value.save()),d.view.items.createList(),d.view.popup.close(),!1}},popup:{items:{createList:function(b){d.view.popup.items.clear(),d._items=d._options.onLoad(d.public,b),d._items=d._options.onSearch(d.public,b),a.each(d._items,function(a){d.view.popup.items.create(a,b)})},create:function(b,c){var e=d.value.exists(b);if(!e||"hide"!==d._options.popupSelectedMode){var f=d._options.onRenderPopupItem(d.public,b,d.items.get(b),c),g=a("<li>").addClass("selectopus-popup-item").html(f).data("value",b).click(d.view.popup.items.onClick).appendTo(d.$popupItems);e&&g.addClass("selectopus-popup-item-selected")}},clear:function(){d.$popupItems.empty()},onClick:function(){var b=a(this).data("value");return d.value.exists(b)?d._options.onUnselect(d.public,b)&&(d.value.remove(b),d.value.save()):d._options.onSelect(d.public,b)&&(d._options.multiple||d.value.clear(),d.value.add(b),d.value.save()),d._options.popupCloseAfterSelect&&d.view.popup.close(),d.view.items.createList(),!1}},get isOpened(){return d.$popup.is(":visible")},toggle:function(){d.view.popup.isOpened?d.view.popup.close():d.view.popup.open()},open:function(){d.view.popup.items.createList();var a=d.$items[0].getBoundingClientRect();d.$popup.css("width",a.width),d.$popup.css("left",a.left),d.$popup.css("top",a.bottom),d.$popup.show(),d.$popupItems.scrollTop(0),d.$input.val("").focus()},close:function(){d.$popup.hide(),d.view.popup.items.clear()},onToggle:function(){return d.view.popup.toggle(),!1},onOpen:function(){return d.view.popup.open(),!1},onClose:function(b){var c=a(b.target);return c[0]!==d.$popup[0]&&c.parents(".selectopus-popup")[0]!==d.$popup[0]&&(d.view.popup.close(),!1)},onSearch:function(){var a=d.$input.val().trim();a.length>0?d.view.popup.items.createList(a):d.view.popup.items.createList()}}},public:{get options(){return d._options},get language(){return d._options.language},set language(a){d.language.set(a)},get items(){return d._items},set items(a){d._items=a},get value(){return d._options.multiple?d.value:d.value[0]},set value(b){d._options.multiple?a.isArray(b)&&(d.value.clear(),d.value.addList(b)):d.value.addList([b]),d.value.save(),d.view.items.createList()},popup:{get isOpened(){return d.view.popup.isOpened},toggle:function(){d.view.popup.toggle()},open:function(){d.view.popup.open()},close:function(){d.view.popup.close()}},utils:{match:function(a,b){if("string"!=typeof a||"string"!=typeof b||0===b.trim().length)return a;var c=new RegExp(b.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),"gi");return a.match(c)},markup:function(a,b){if("string"!=typeof a||"string"!=typeof b||0===b.trim().length)return a;var c=new RegExp(b.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),"gi");return a.replace(c,function(a){return"<mark>"+a+"</mark>"})}}}};return d.init(b,c),d.public}a.fn.selectopus=function(c){return this.each(function(){var d=a(this),e=d.data("selectopus");return void 0===e&&(e=new b(d,c),d.data("selectopus",e)),e}).data("selectopus")},a.fn.selectopus.default={items:{},value:[],language:"en",multiple:!1,popupSelectedMode:"highlite",popupSearchHide:!0,popupSearchHighlight:!0,popupCloseAfterSelect:!0,url:"http://mear.me/source.json?text=",onLoad:function(b,c){if(!b.options.url)return b.options.items;var d={};try{d=a.getJSON(b.options.url+c)}catch(a){d={}}return a.isPlainObject(d)||(d={}),d},onSearch:function(b,c){if(!b.options.popupSearchHide||void 0===c||0===c.trim().length)return b.items;var d={};return a.each(b.items,function(a,e){b.utils.match(e,c)&&(d[a]=e)}),d},onSelect:function(a,b){return!0},onUnselect:function(a,b){return!0},onRenderItem:function(a,b,c){return c},onRenderPopupItem:function(a,b,c,d){return a.options.popupSearchHighlight&&(c=a.utils.markup(c,d)),c}},a("body").ready(function(){a(".selectopus").selectopus()}),a.fn.selectopus.languages={}}(jQuery),function(a){a.fn.selectopus.languages.en={popupSearchPlaceholder:"Start type for search items...",popupSearchNotFound:"No results found"}}(jQuery),function(a){a.fn.selectopus.languages.ru={popupSearchPlaceholder:"Начните писать, что бы найти элементы...",popupSearchNotFound:"Совпадений не найдено"}}(jQuery);