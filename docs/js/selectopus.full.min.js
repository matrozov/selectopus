!function(a){function b(b,c){var d={items:{},value:[],languages:{},options:{},$element:!1,$root:!1,$items:!1,$input:!1,$popup:!1,init:function(b,c){d.$element=b,d.$element.hide(),d.languages=a.fn.selectopus.languages,d.options=a.extend({},a.fn.selectopus.default,d.optionsPredefined(),c),d.create(),d.public.language=d.options.language,d.public.items=d.options.items,d.public.value=d.options.value,d.itemsCreate()},create:function(){d.$root=a("<div>").addClass("selectopus-root").insertAfter(d.$element),d.options.multiple&&d.$root.addClass("selectopus-multiple"),d.$items=a("<div>").addClass("selectopus-items form-control").click(d.onPopupToggle).appendTo(d.$root),d.$popup=a("<div>").addClass("selectopus-popup").appendTo("body"),d.$input=a("<input>").attr("type","text").addClass("selectopus-popup-input form-control input-sm").keyup(d.onPopupSearch).appendTo(d.$popup),d.$popupItems=a("<ul>").addClass("selectopus-popup-items").appendTo(d.$popup),a(document).click(d.onPopupClose)},optionsPredefined:function(){var b={multiple:d.$element.is("[multiple]"),items:{},value:[]};d.$element.find("option").each(function(){var c=a(this),d=c.prop("value");b.items[d]=c.text(),c.prop("selected")&&(b.multiple?b.value.push(d):b.value=d)});var c=a("html").attr("lang");return d.languageExists(c)&&(b.language=c),b},languageExists:function(a){return void 0!==d.languages[a]},languageGet:function(a){return d.languages[d.options.language][a]},languageReload:function(){d.$input.attr("placeholder",d.languageGet("popupSearchPlaceholder"))},itemsClear:function(){d.$items.empty()},itemsCreate:function(){d.itemsClear(),a.each(d.value,function(a,b){d.itemCreate(b)})},itemCreate:function(b){return a("<span>").addClass("selectopus-item").html(d.options.onRenderItem(d.public,b,d.items[b])).data("value",b).click(d.onItemClick).appendTo(d.$items)},popupItemsClear:function(){d.$popupItems.empty()},popupItemsCreate:function(b){d.popupItemsClear(),d.items=d.options.onSearch(d,b),a.each(d.items,function(a){d.popupItemCreate(a,b)})},popupItemCreate:function(b,c){var e=d.value.indexOf(b)>-1;if(!e||"hide"!==d.options.popupSelectedMode){var f=a("<li>").addClass("selectopus-popup-item").html(d.options.onRenderPopupItem(d.public,b,d.items[b],c)).data("value",b).click(d.onPopupItemClick).appendTo(d.$popupItems);return e&&f.addClass("selectopus-popup-item-selected"),f}},saveValue:function(){d.$element.empty(),a.each(d.value,function(b,c){a("<option>").attr("selected",!0).text(c).appendTo(d.$element)})},onItemClick:function(){var b=a(this).data("value"),c=d.value.indexOf(b);return d.options.onUnselect(d,b)&&(d.value.splice(c,1),d.public.value=d.value),d.public.popupClose(),!1},onPopupToggle:function(){return d.public.popupToggle(),!1},onPopupOpen:function(){return d.public.popupOpen(),!1},onPopupClose:function(b){var c=a(b.target);return c[0]!==d.$popup[0]&&c.parents(".selectopus-popup")[0]!==d.$popup[0]&&(d.public.popupClose(),!1)},onPopupItemClick:function(){var b=a(this).data("value"),c=d.value.indexOf(b);return c>-1?d.options.onUnselect(d,b)&&(d.value.splice(c,1),d.public.value=d.value):d.options.onSelect(d,b)&&(d.options.multiple?(d.value.push(b),d.public.value=d.value):d.public.value=b),d.options.popupCloseAfterSelect&&d.public.popupClose(),!1},onPopupSearch:function(){var a=d.$input.val().trim();a.length>0?d.popupItemsCreate(a):d.popupItemsCreate()},public:{get options(){return d.options},get language(){return d.options.language},set language(a){d.languageExists(a)&&(d.options.language=a,d.languageReload())},get items(){return d.items},set items(a){d.items=a},get value(){return d.options.multiple?d.value:d.value[0]},set value(b){d.options.multiple?a.isArray(b)&&(d.value=b):d.value=[b],d.itemsCreate(),d.saveValue()},isPopupOpened:function(){return d.$popup.is(":visible")},popupToggle:function(){d.public.isPopupOpened()?d.public.popupClose():d.public.popupOpen()},popupOpen:function(){d.popupItemsCreate();var a=d.$items[0].getBoundingClientRect();d.$popup.css("width",a.width),d.$popup.css("left",a.left),d.$popup.css("top",a.bottom),d.$popup.show(),d.$popupItems.scrollTop(0),d.$input.focus()},popupClose:function(){d.$popup.hide(),d.popupItemsClear()},markup:function(a,b){if("string"!=typeof a||void 0===b||0===b.trim().length)return a;var c=new RegExp(b.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),"gi");return a.replace(c,function(a){return"<mark>"+a+"</mark>"})}}};return d.init(b,c),d.public}a.fn.selectopus=function(c){return this.each(function(){var d=a(this),e=d.data("selectopus");return void 0===e&&(e=new b(d,c),d.data("selectopus",e)),e}).data("selectopus")},a.fn.selectopus.default={items:{},value:[],language:"en",multiple:!1,popupSelectedMode:"highlite",popupSearchHighlight:!0,popupCloseAfterSelect:!0,onSearch:function(b,c,d){if(void 0===d||0===d.trim().length)return b.options.items;var e={};return a.each(b.options.items,function(a,b){b.indexOf(d)!==-1&&(e[a]=b)}),e},onSelect:function(a,b){return!0},onUnselect:function(a,b){return!0},onRenderItem:function(a,b,c){return c},onRenderPopupItem:function(a,b,c,d){return a.options.popupSearchHighlight&&(c=a.markup(c,d)),c}},a("body").ready(function(){a(".selectopus").selectopus()}),a.fn.selectopus.languages={}}(jQuery),function(a){a.fn.selectopus.languages.en={popupSearchPlaceholder:"Start type for search items...",popupSearchNotFound:"No results found"}}(jQuery),function(a){a.fn.selectopus.languages.ru={popupSearchPlaceholder:"Начните писать, что бы найти элементы...",popupSearchNotFound:"Совпадений не найдено"}}(jQuery);